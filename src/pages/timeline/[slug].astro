---
import BaseLayout from '../../layouts/BaseLayout.astro';
import timelineData from '../../data/timeline.json';
import contentData from '../../data/content.json';
import { Button } from '../../components/ui/button';
import { TextToSpeech } from '../../components/TextToSpeech';
import tuyenNgonDocLap from '../../assets/tuyen-ngon-doc-lap.jpg';

export async function getStaticPaths() {
  const entries = timelineData as any[];
  return entries.map((e) => ({
    params: { slug: e.slug },
  }));
}

const { slug } = Astro.params;
const entries = timelineData as any[];
const entry = entries.find((e) => e.slug === slug);
const contentMap = contentData as any;
const article = entry ? contentMap[entry.id] : null;

if (!entry || !article) {
  throw new Error(`Timeline entry or content not found for slug: ${slug}`);
}
---

<BaseLayout title={entry.title}>
  <!-- Hero Section - Minimal with just title -->
  <section class="relative overflow-hidden bg-gradient-to-b from-[#1a0000] via-[#210000] to-background text-[color:var(--vn-yellow-soft)]">
    <div class="pointer-events-none absolute inset-0">
      <img 
        src={tuyenNgonDocLap.src} 
        alt="Tuyên ngôn độc lập" 
        class="h-full w-full object-cover opacity-80"
      />
      <div class="absolute inset-0 bg-gradient-to-b from-black/30 via-black/35 to-black/50" />
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_0,rgba(245,230,99,0.12),transparent_55%),radial-gradient(circle_at_80%_120%,rgba(139,26,26,0.4),transparent_60%)]" />
    </div>
    
    <div class="relative mx-auto max-w-3xl px-4 pb-12 pt-24 md:pb-16 md:pt-32">
      <!-- Back Button - Inside hero section -->
      <Button asChild size="lg" variant="outline" class="group mb-8 border-[3px] border-[color:var(--vn-yellow-soft)] bg-gradient-to-r from-[#1a0000] to-[#2d0000] px-6 py-3 text-[color:var(--vn-yellow-soft)] shadow-[0_0_20px_rgba(245,230,99,0.3)] backdrop-blur-sm transition-all duration-300 hover:scale-110 hover:border-[color:var(--vn-red-soft)] hover:bg-gradient-to-r hover:from-[color:var(--vn-red-soft)] hover:to-[#8b1a1a] hover:text-white hover:shadow-[0_0_30px_rgba(139,26,26,0.6)]">
        <a href="/timeline" class="flex items-center gap-3">
          <span class="text-2xl font-bold transition-transform group-hover:-translate-x-2">←</span>
          <span class="text-base font-bold tracking-wide">Quay lại Timeline</span>
        </a>
      </Button>

      <p class="mb-3 text-center text-4xl font-bold leading-tight tracking-tight text-[color:var(--vn-yellow-soft)] md:text-5xl lg:text-6xl">
        {entry.date}
      </p>

      <h1 class="text-center text-4xl font-bold leading-tight tracking-tight md:text-5xl lg:text-6xl">
        {entry.title}
      </h1>
    </div>
  </section>

  <!-- Content Section - Description + Paragraphs + Image integrated -->
  <section class="bg-background py-12 md:py-16">
    <div class="mx-auto max-w-3xl px-4">
      <!-- Text-to-Speech at top -->
      <div class="mb-8 flex items-center justify-between">
        <p class="text-sm text-muted-foreground"></p>
        <TextToSpeech 
          client:load 
          text={article.paragraphs?.join(' ') || ''} 
          title={entry.title}
        />
      </div>

      <!-- Short description as lead paragraph -->
      <p class="mb-8 text-xl leading-relaxed italic text-foreground first-letter:float-left first-letter:mr-3 first-letter:text-7xl first-letter:font-bold first-letter:not-italic first-letter:leading-none first-letter:text-[color:var(--vn-red-soft)] md:text-2xl md:first-letter:text-8xl">
        {entry.short}
      </p>
      
      <!-- Article content -->
      <div class="space-y-6">
        {article.paragraphs?.map((paragraph: string, idx: number) => (
          <p key={idx} class="text-lg leading-relaxed text-justify text-foreground">
            {paragraph}
          </p>
        ))}
      </div>

      <!-- Image at the end with caption -->
      {article.image && (
        <figure class="mt-10">
          <div class="overflow-hidden rounded-xl">
            <img
              src={article.image}
              alt={entry.title}
              class="h-full w-full object-cover"
              loading="lazy"
            />
          </div>
          <figcaption class="mt-3 text-center text-sm text-muted-foreground">
            Ảnh: {article.title}
          </figcaption>
        </figure>
      )}
    </div>
  </section>
</BaseLayout>


