---
import BaseLayout from '../../layouts/BaseLayout.astro';
import timelineData from '../../data/timeline.json';
import contentData from '../../data/content.json';
import { Button } from '../../components/ui/button';
import tuyenNgonDocLap from '../../assets/tuyen-ngon-doc-lap.jpg';

export async function getStaticPaths() {
  const entries = timelineData as any[];
  return entries.map((e) => ({
    params: { slug: e.slug },
  }));
}

const { slug } = Astro.params;
const entries = timelineData as any[];
const entry = entries.find((e) => e.slug === slug);
const contentMap = contentData as any;
const article = entry ? contentMap[entry.id] : null;

if (!entry || !article) {
  throw new Error(`Timeline entry or content not found for slug: ${slug}`);
}
---

<BaseLayout title={entry.title}>
  <section class="relative overflow-hidden bg-gradient-to-b from-[#1a0000] via-[#210000] to-background text-[color:var(--vn-yellow-soft)] md:min-h-[420px]">
    <div class="pointer-events-none absolute inset-0">
      <!-- Background image -->
      <img 
        src={tuyenNgonDocLap.src} 
        alt="Tuyên ngôn độc lập" 
        class="h-full w-full object-cover opacity-80"
      />
      <!-- Overlay để text dễ đọc -->
      <div class="absolute inset-0 bg-gradient-to-b from-black/30 via-black/35 to-black/50" />
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_20%_0,rgba(245,230,99,0.12),transparent_55%),radial-gradient(circle_at_80%_120%,rgba(139,26,26,0.4),transparent_60%)]" />
    </div>
    
    <div class="relative mx-auto max-w-6xl px-4 pb-16 pt-32 md:pb-24 md:pt-40">
      <Button asChild size="sm" variant="outline" class="mb-4 border-[color:var(--vn-yellow-soft)]/70 bg-[#260000]/80 text-[color:var(--vn-yellow-soft)] hover:bg-[#3a0000]">
        <a href="/timeline">← Quay lại Timeline</a>
      </Button>
      <div class="grid gap-6 md:grid-cols-[3fr,2fr] md:items-start">
        <div>
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-[color:var(--vn-yellow-soft)]/90">
            {entry.date}
          </p>
          <h1 class="mt-3 text-3xl font-bold tracking-tight md:text-4xl">
            {entry.title}
          </h1>
          <p class="mt-3 max-w-2xl text-sm text-[color:var(--vn-yellow-soft)]/90 md:text-base">
            {entry.short}
          </p>
        </div>
        {article.image && (
          <div class="overflow-hidden rounded-2xl border border-[color:var(--vn-red-soft)]/45 bg-[#050000]/90 shadow-[0_0_40px_rgba(139,0,0,0.5)]">
            <img
              src={article.image}
              alt={entry.title}
              class="h-full w-full object-cover"
              loading="lazy"
            />
          </div>
        )}
      </div>
    </div>
  </section>

  <section class="bg-background">
    <div class="mx-auto grid max-w-6xl gap-8 px-4 py-12 md:grid-cols-[3fr,2fr] md:py-16">
      <article class="prose prose-sm max-w-none text-foreground prose-p:mb-4 prose-p:mt-0 prose-headings:mt-6 prose-headings:mb-3 prose-strong:text-foreground">
        {article.paragraphs?.map((paragraph: string, idx: number) => (
          <p key={idx}>{paragraph}</p>
        ))}
      </article>
    </div>
  </section>
</BaseLayout>


